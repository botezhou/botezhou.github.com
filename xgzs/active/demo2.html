<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
        
		*{ margin:0; padding:0; list-style:none;}
        body{background: url(../img/2.jpg) no-repeat;background-size:100%; overflow: hidden;position:relative;}
        img{ vertical-align:top;}
        h1{margin-left:620px;margin-top:60px;text-shadow:5px 10px 5px orange;color:#000;}
        #oUl{ width:490px; margin-top:20px;margin-left: 500px;overflow: hidden;}
        #oUl li{ width:150px; height:150px; margin:5px; float:left;box-shadow: inset 2px 5px 10px #0ff,2px 5px 5px #000;}
        #oUl li img{ width:100%; height:100%;}
        
	</style>
    <script src="../move.js"></script>
	<script>
	window.onload=function(){
		var oUl=document.getElementById('oUl');
		var aLi=oUl.children;
		var arr=[];
		var zIndex=2;
		// 布局转化
	    for (var i = 0; i < aLi.length; i++) {
	    	arr.push({left:aLi[i].offsetLeft,top:aLi[i].offsetTop});
	    };
	    // 赋值
        for (var i = 0; i < aLi.length; i++) {
        	aLi[i].style.left=arr[i].left+'px';
        	aLi[i].style.top=arr[i].top+'px';
        	aLi[i].style.position='absolute';
        	aLi[i].style.margin=0;
        }
        // 加拖拽
        for (var i = 0; i < aLi.length; i++) {
        	 drag(aLi[i]);
        	 aLi[i].index=i;
        };

        // 拖拽函数
        function drag(obj){
        	obj.onmousedown=function(ev){
        		var oEvent=ev||event;
        		var disX=oEvent.clientX-obj.offsetLeft;
        		var disY=oEvent.clientY-obj.offsetTop;
        		obj.style.zIndex=zIndex++;
        		document.onmousemove=function(ev){
        			var oEvent=ev||event;
        			var l=oEvent.clientX-disX;
        			var t=oEvent.clientY-disY;
        			obj.style.left=l+'px';
        			obj.style.top=t+'px';
        			for (var i = 0; i < aLi.length; i++) {
        				aLi[i].className='';
        			}
        			var oNear=findNear(obj);
        			if(oNear){
        			    oNear.className='ac';
        			}
        		}
        		document.onmouseup=function(){
        			// obj==>oNear
        			// oNear==obj
        			var oNear=findNear(obj);
        			if(oNear){
        				// oNear.style.left=arr[obj.index].left+'px';
        				// oNear.style.top=arr[obj.index].top+'px';
        				// obj.style.left=arr[oNear.index].left+'px';
        				// obj.style.top=arr[oNear.index].top+'px';
        				// var car=oNear.index;
        				// oNear.index=obj.index;
        				// obj.index=car;
                        move(oNear,{
                            'left':arr[obj.index].left,
                            'top':arr[obj.index].top
                        },{type:'linear',time:300});
                        move(obj,{
                            'left':arr[oNear.index].left,
                            'top':arr[oNear.index].top
                        },{type:'linear',time:300});
                        var car=oNear.index;
                        oNear.index=obj.index;
                        obj.index=car  
        			}else{
        				// obj.style.left=arr[obj.index].left+'px';
        				// obj.style.top=arr[obj.index].top+'px';
                        move(obj,{
                            'left':arr[obj.index].left,
                            'top':arr[obj.index].top
                        },{type:'linear',time:300})
        			}
        			oNear.className='';
        			document.onmousemove=null;
        			document.onmouseup=null;
        		}
        		return false;
        	}
        }
        // 碰撞检测
        function collTest(obj,obj2){
        	var l=obj.offsetLeft;
        	var r=obj.offsetLeft+obj.offsetWidth;
        	var t=obj.offsetTop;
        	var b=obj.offsetTop+obj.offsetHeight;
        	var l2=obj2.offsetLeft;
        	var r2=obj2.offsetLeft+obj2.offsetWidth;
        	var t2=obj2.offsetTop;
        	var b2=obj2.offsetTop+obj2.offsetHeight;
        	if(l>r2||r<l2||t>b2||b<t2){
        		return false;
        	}else{
        		return true;
        	}
        }
        //求距离
        function getDis(obj,obj2){
        	var a=obj2.offsetLeft-obj.offsetLeft;
        	var b=obj2.offsetTop-obj.offsetTop
        	return Math.sqrt(a*a+b*b);
        }
        // 求最小距离
        function findNear(obj){
        	var iMin=9999999;
        	var iMinIndex=-1;
        	for (var i = 0; i < aLi.length; i++) {
        		 if(obj==aLi[i])continue;
        		 if(collTest(obj,aLi[i])){
        		 	var dis=getDis(obj,aLi[i]);
        		 	if(dis<iMin){
        		 		iMin=dis;
        		 		iMinIndex=i;
        		 	}
        		}
        	}
        	if(iMinIndex==-1){
        		return false;
        	}else{
        		return aLi[iMinIndex];
        	}
        }
	}
	</script>
</head>
<body>
    <h1>试试看拖动图片</h1>
	<ul id="oUl">
        <li><img src="cat/1.jpg" alt=""></li>
        <li><img src="cat/2.jpg" alt=""></li>
        <li><img src="cat/3.jpg" alt=""></li>
        <li><img src="cat/4.jpg" alt=""></li>
        <li><img src="cat/5.jpg" alt=""></li>
        <li><img src="cat/6.jpg" alt=""></li>
        <li><img src="cat/7.jpg" alt=""></li>
        <li><img src="cat/8.jpg" alt=""></li>
        <li><img src="cat/9.jpg" alt=""></li>
    </ul>
</body>
</html>